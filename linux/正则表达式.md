﻿# 正则表达式

搜索文件的时候，我们会用到 ? * 等符号查找具有某种特征的文件，从此引出正则表达式的概念。正则表达式更加灵活，功能强大。

## 一、简介

### 1、认识正则表达式

下面是一个正则表达式的例子。e.g.

```shell
^[0-9]+abc$
```

正则表达式以 <code>^</code> 开头，以 <code>$</code> 结尾。

<code>[0-9]</code> 表示匹配 0 - 9 的单个字符

<code>[0-9]+</code> 匹配一个或多个0 - 9 的字符，+ 代表一个或多个，可以用到其他地方。

<code>abc</code> 匹配 <code>abc</code> 

另一个例子 e.g.

```shell
^[a-z0-9_-]{3,15}$
```

<code>[a-z0-9_-]</code> 匹配其中一个字符

<code>{3,15}</code> 匹配 3 到 15 个 <code>[a-z0-9_-]</code> 中的字符

### 2、支持正则表达式的语言/程序/命令

- <code>vi</code> 
- <code>Visual C++</code> 
- <code>awk</code> 
- <code>sed</code> 
- <code>delphi</code> 
- <code>python</code> 
- <code>java</code> 
- <code>javascript</code> 
- <code>php</code> 
- <code>perl</code> 
- <code>C#</code> 

## 二、语法

```shell
+ 匹配前面一个或多个字符
* 匹配 0个 一个 或多个字符
? 匹配 0个 或一个字符
```

### 1、普通字符

```shell
[aeiou] # 匹配 [] 出现的字符
[^aeiou] # 匹配除了 [] 中的字符
[A-Z] # 匹配所有大写字母
[a-z]
[0-9]
[.] # 匹配除了换行符（\n \r）的所有单个字符
# 相当于 /[^\n\r]/g
[\s\S] # \s 匹配所有空白符吗，包括换行；\S 非空白符
\w # 相当于 [A-Za-z0-9_]
```

### 2、非打印字符

```shell
\cx	# 匹配由x指明的控制字符。例如， \cM 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 'c' 字符。
\f  # 匹配一个换页符。 == \x0c  \cL
\n  # 匹配一个换行符。 == \x0a  \cJ
\r  # 匹配一个回车符。 == \x0d  \cM
\s  # 
\S  # 
\t  # 匹配一个制表符。 == \x09  \cI
\v  # 匹配一个垂直制表符。 == \x0b  \cK
```

### 3、特殊字符

要匹配特殊字符，请用转义字符。<code>\\</code> 

下面是需要转义的字符

```shell
$
()
*
+
.
[
?
\
^
{
|
```

### 4、限定符

```shell
* # >= 0
+ # >= 1
? # 0 or 1
{n} # 前面的字符匹配确定的 n 次
{n,} # >= n
{n,m} # >= n and <= m
```

<code>*</code> 和 <code>+</code> 限定符都是贪婪的，因为它们会尽可能多的匹配文字，只有在它们的后面加上一个 <code>?</code> 就可以实现非贪婪或最小匹配

### 5、定位符

```shell
^	# 字符串开始位置
$	# 字符串结束位置
\b	# 匹配单词边界，即字与空格间的位置
\B	# 非单词边界匹配
```

> 不能将限定符与定位符一起使用，如 ^*

### 6、选择

用 <code>()</code> 将所有选择项括起来，相邻的选择项之间用 <code>|</code> 分隔。

```shell
str="123hello456world"
/([1-9])([a-z]+)/
# 匹配 3hello  6world
```

<code>()</code>表示捕获分组，<code>()</code> 会把每个分组里的匹配的值保存起来， 多个匹配值可以通过数字 **n** 来查看， **n** 是一个数字，表示第 n 个捕获组的内容)。

但用圆括号会有一个副作用，使相关的匹配会被缓存，此时可用 <code>?:</code> 放在第一个选项前来消除这种副作用。

其中 <code>?:</code> 是非捕获元之一，还有两个非捕获元是 <code>?=</code> 和 <code>?!</code>，这两个还有更多的含义，前者为正向预查，在任何开始匹配圆括号内的正则表达式模式的位置来匹配搜索字符串，后者为负向预查，在任何开始不匹配该正则表达式模式的位置来匹配搜索字符串。

```shell
(?:pattern) 
# 非获取匹配，匹配pattern但不获取匹配结果，不进行存储供以后使用。
# 这在使用或字符“(|)”来组合一个模式的各个部分是很有用。
# 例如“industr(?:y|ies)”就是一个比“industry|industries”更简略的表达式。
(?=pattern)
# 非获取匹配，正向肯定预查，在任何匹配pattern的字符串开始处匹配查找字符串，该匹配不需要获取供以后使用。
# 例如，“Windows(?=95|98|NT|2000)”能匹配“Windows2000”中的“Windows”，但不能匹配“Windows3.1”中的“Windows”。
# 预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。
(?!pattern)
# 非获取匹配，正向否定预查，在任何不匹配pattern的字符串开始处匹配查找字符串，该匹配不需要获取供以后使用。
# 例如“Windows(?!95|98|NT|2000)”能匹配“Windows3.1”中的“Windows”，但不能匹配“Windows2000”中的“Windows”。
(?<=pattern)
# 非获取匹配，反向肯定预查，与正向肯定预查类似，只是方向相反。
# 例如，“(?<=95|98|NT|2000)Windows”能匹配“2000Windows”中的“Windows”，但不能匹配“3.1Windows”中的“Windows”。
(?<!pattern)
# 非获取匹配，反向否定预查，与正向否定预查类似，只是方向相反。
# 例如“(?<!95|98|NT|2000)Windows”能匹配“3.1Windows”中的“Windows”，但不能匹配“2000Windows”中的“Windows”。
# 这个地方不正确，有问题 
```

### 7、反向引用

反向引用的最简单的、最有用的应用之一，是提供查找文本中两个相同的相邻单词的匹配项的能力。

```javascript
var str = "Is is the cost of of gasoline going up up";
var patt1 = /\b([a-z]+) \1\b/ig;
document.write(str.match(patt1));

// \1 指定第一个子匹配项
```

## 三、修饰符（标记）

### 1、修饰符

```shell
i	# ignore 忽略大小写
g	# global 全局匹配,查找所有匹配项
m	# more 多行匹配，而不是整个字符串
s	# 让 . 包含换行符 \n
# . 默认是除了 \n 以外的所有字符
```

### 2、格式

```shell
/string/igms
```

## 四、元字符

```shell
\
^
$
*
+
?
{n}
{n,}
{n,m}
?
.
(pattern)
(?:pattern)
(?=pattern)
(?!pattern)
# TODO 以后再写
```

## 五、运算符优先级

相同优先级的表达式从左到右计算，不同优先级的运算先高后低。

```shell
#1 转义符
\
#2 圆括号与方括号
()
(?:)
(?=)
[]
#3 限定符
*
+
?
{n}
{n,}
{n,m}
#4 定位点和序列
^
$
\任何元字符、任何字符
#5 替换
|
#例子 "(m|f)ood"
```

## 六、匹配规则

```shell
^once
bucket$
^bucket$
once
^\t			# 检测一个字符串是否以制表符开头
```

### 1、字符簇

```shell
[AaEeIiOoUu]	# 只表示一个字符
[a-z]			# 表示一个字符的范围
```

### 2、PHP自带字符簇

| 字符簇       | 描述                                |
| ------------ | ----------------------------------- |
| [[:alpha:]]  | 任何字母                            |
| [[:digit:]]  | 任何数字                            |
| [[:alnum:]]  | 任何字母和数字                      |
| [[:space:]]  | 任何空白字符                        |
| [[:upper:]]  | 任何大写字母                        |
| [[:lower:]]  | 任何小写字母                        |
| [[:punct:]]  | 任何标点符号                        |
| [[:xdigit:]] | 任何16进制的数字，相当于[0-9a-fA-F] |

### 3、确定出现次数

```shell
^a{3}$		# aaa
# 略，上文已记录
```

